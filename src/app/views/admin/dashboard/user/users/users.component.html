<div class="content container-fluid">

    <!-- Page Header -->
    <div class="page-header">
      <div class="row align-items-center">
        <div class="col">
          <h3 class="page-title"  >List of users</h3>
          <ul class="breadcrumb">
            <li class="breadcrumb-item"><a routerLink=""  ><span >home</span></a></li>
            <li class="breadcrumb-item active"  > <span >users</span> </li>
          </ul>
        </div>
        <div class="col-auto float-end ms-auto">
          <a class="btn add-btn" (click)="add()"><i class="fa fa-plus"></i>
            <span>Users</span> </a>
        </div>
        <div class="col-auto float-end ms-auto">
          <a class="btn add-btn" [routerLink]="'/users'">
            <span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M13.125 12h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125M20.625 12c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5M12 14.625v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 14.625c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 1.5v-1.5m0 0c0-.621.504-1.125 1.125-1.125m0 0h7.5" />
            </svg>
            </span> </a>
        </div>
      </div>
    </div>
    <div class="search">
    <div class="col-md-3">
      <div class="input-group">
        
        <input type="text" class="form-control" [(ngModel)]="searchValue" placeholder="Search...">
        <span class="input-group-text">
          <i class="fa fa-search"></i>          
          </span>
      </div>
    </div>
    </div>
    <div class="table-responsive">
      <table class="table caption-top  table-hover">
        <caption class="caption">List of users</caption>
        <thead class="thead-light">
          <tr>
            

            <th class="fw-bold mb-1" scope="col">User Name</th>
            <th class="fw-bold mb-1" scope="col">Titre</th>
            <th class="fw-bold mb-1" scope="col">Last Name</th>
            <th class="fw-bold mb-1" scope="col">Phone Number</th>
            <th class="fw-bold mb-1" scope="col">Roles</th>
    
            <th class="fw-bold mb-1">Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let item of dataArray | filter: searchValue">
            <td>
                <div class="d-flex align-items-center">
                  <img
                  [src]="'data:image/jpeg;base64,' + item.profilePicture" 
                      alt=""
                      style="width: 45px; height: 45px"
                      class="rounded-circle"
                      />
                      
                  <div class="ms-3">
                    <p class="fw-bold mb-1">{{item.firstname}}</p>
                    <p class="text-muted mb-0">{{item.email}}</p>
                  </div>
                </div>
              </td>
            
            <td>{{item.titre}}</td>
            <td>{{item.userLastName}}</td>
            <td>{{item.phoneNumber}}</td>
          
            <td *ngIf="item.roles && item.roles.length > 0">
                <div *ngFor="let role of item.roles">
                  {{role.roleName}}
                </div>
              </td>
              <td *ngIf="!item.roles || item.roles.length === 0"class="text-center">-</td>
          
             
            <td>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-success btn-sm" (click)="editer(item)">
                  <span class="btn-circle btn-circle-success">
                    <i class="fa fa-pencil"></i>
                  </span>
                </button>
                <button type="button" class="btn btn-outline-info btn-sm" (click)="details(item)">
                  <span class="btn-circle btn-circle-info">
                    <i class="fa fa-eye"></i>
                  </span>
                </button>
                <button type="button" class="btn btn-outline-danger btn-sm" (click)="confirmDeleteUser(item.id)">
                  <span class="btn-circle btn-circle-danger">
                    <i class="fa fa-trash"></i>
                  </span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  <div class="overlay" *ngIf="showPopup"></div>
    <div class="popup" *ngIf="showPopup" >
      <button class="close" (click)="togglePopup()"> <i class="fas fa-times"></i></button>
      <form class="row g-3" #userForm="ngForm">
        <input type="hidden" name="id"  [(ngModel)]="selectedUser.id" required>
  
        <div class="col-md-5">
          <label class="form-label">project Name</label>
          <input type="text" class="form-control" name="firstname" [(ngModel)]="selectedUser.firstname" required >
          <div class="alert alert-danger" role="alert" *ngIf="userForm.submitted && userForm.controls['firstname']?.errors?.['required'] ">
            Identifier is required
         </div>
        </div>
  
        <div class="col-md-5">
          <label class="form-label">objective</label>
          <input type="text" class="form-control" name="userLastName" [(ngModel)]="selectedUser.userLastName" required>
          <div class="alert alert-danger" role="alert" *ngIf="userForm.submitted && userForm.controls['userLastName']?.errors?.['required'] ">
            Identifier is required
         </div>
        </div>
        <div class="mb-3">
          <label class="form-label">projectManager</label>
  
          <input type="email" class="form-control" name="email" [(ngModel)]="selectedUser.email" required>
          <div class="alert alert-danger" role="alert" *ngIf="userForm.submitted && userForm.controls['email']?.errors?.['required'] ">
            Identifier is required
         </div>
         <div class="alert alert-danger" role="alert" *ngIf="errorMessage">{{ errorMessage }}</div>
  
        </div>
        
  
           <div  class="col-md-5">
          <label class="form-label">phoneNumber</label>
          <input type="text" class="form-control" name="phoneNumber" [(ngModel)]="selectedUser.phoneNumber"required  >
          <div class="alert alert-danger" role="alert" *ngIf="userForm.submitted && userForm.controls['phoneNumber']?.errors?.['required'] ">
            Identifier is required
         </div>
  
        </div>
        <div  class="col-md-5">
          <label class="form-label">descriptionP</label>
          <input  class="form-control" name="titre"[(ngModel)]="selectedUser.titre"required>
          <div class="alert alert-danger" role="alert" *ngIf="userForm.submitted && userForm.controls['titre']?.errors?.['required'] ">
            Identifier is required
         </div>
        </div>
        <div class="col-md-5">
            <label class="form-label">Roles</label>
            <div *ngIf="selectedUser.roles.length > 0">
                <div *ngFor="let role of selectedUser.roles; let i=index">
                  <div class="bouton" >
                       <select class="form-control" [(ngModel)]="role.roleName" [name]="'roleName' + (i+1)">
                      <option value="admin">admin</option>
                      <option value="manager">manager</option>
                      <option value="user">user</option>
                    </select>
                
                    <input type="hidden" [(ngModel)]="role.id" [name]="'roleId' + (i+1)">
                    <button type="button" class="btn btn-primary" (click)="removeRole(i)">          <mat-icon>delete</mat-icon>
                    </button>
                </div>
                </div>
                <button type="button" class="btn btn-primary"  *ngIf="selectedUser.roles.length === 0 || selectedUser.roles.length > 0" (click)="addRole()">Add Role</button>
  
            </div>
            <button type="button" class="btn btn-primary" *ngIf="selectedUser.roles.length === 0" (click)="addRole()">Add Role</button>
        </div>
  
  
  
  
        <button type="submit" class="btn btn-primary"  (click)="updateUser()">Update</button>
      </form>
    </div>
  
  
  
  
  </div>
  
  
  
  
  
  
  
  